# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2023.

import sys, csv, re

codes = [{"code":"101720.0","system":"med"},{"code":"102311.0","system":"med"},{"code":"102446.0","system":"med"},{"code":"104760.0","system":"med"},{"code":"104763.0","system":"med"},{"code":"10575.0","system":"med"},{"code":"107222.0","system":"med"},{"code":"109634.0","system":"med"},{"code":"11055.0","system":"med"},{"code":"11172.0","system":"med"},{"code":"11244.0","system":"med"},{"code":"12771.0","system":"med"},{"code":"14743.0","system":"med"},{"code":"1494.0","system":"med"},{"code":"14971.0","system":"med"},{"code":"15733.0","system":"med"},{"code":"15958.0","system":"med"},{"code":"16537.0","system":"med"},{"code":"16764.0","system":"med"},{"code":"16905.0","system":"med"},{"code":"17281.0","system":"med"},{"code":"18053.0","system":"med"},{"code":"20572.0","system":"med"},{"code":"20785.0","system":"med"},{"code":"2113.0","system":"med"},{"code":"2117.0","system":"med"},{"code":"22188.0","system":"med"},{"code":"22644.0","system":"med"},{"code":"23616.0","system":"med"},{"code":"24107.0","system":"med"},{"code":"25546.0","system":"med"},{"code":"28562.0","system":"med"},{"code":"30619.0","system":"med"},{"code":"30985.0","system":"med"},{"code":"31362.0","system":"med"},{"code":"31455.0","system":"med"},{"code":"31493.0","system":"med"},{"code":"31589.0","system":"med"},{"code":"31738.0","system":"med"},{"code":"32222.0","system":"med"},{"code":"33338.0","system":"med"},{"code":"33383.0","system":"med"},{"code":"33410.0","system":"med"},{"code":"33693.0","system":"med"},{"code":"33847.0","system":"med"},{"code":"34236.0","system":"med"},{"code":"34389.0","system":"med"},{"code":"34966.0","system":"med"},{"code":"35274.0","system":"med"},{"code":"35848.0","system":"med"},{"code":"35877.0","system":"med"},{"code":"37580.0","system":"med"},{"code":"37681.0","system":"med"},{"code":"38063.0","system":"med"},{"code":"3890.0","system":"med"},{"code":"39062.0","system":"med"},{"code":"39316.0","system":"med"},{"code":"3984.0","system":"med"},{"code":"40386.0","system":"med"},{"code":"40981.0","system":"med"},{"code":"41022.0","system":"med"},{"code":"4261.0","system":"med"},{"code":"43405.0","system":"med"},{"code":"43800.0","system":"med"},{"code":"4390.0","system":"med"},{"code":"44498.0","system":"med"},{"code":"47947.0","system":"med"},{"code":"48054.0","system":"med"},{"code":"4843.0","system":"med"},{"code":"49223.0","system":"med"},{"code":"49420.0","system":"med"},{"code":"49761.0","system":"med"},{"code":"49852.0","system":"med"},{"code":"50060.0","system":"med"},{"code":"50248.0","system":"med"},{"code":"51322.0","system":"med"},{"code":"51903.0","system":"med"},{"code":"53032.0","system":"med"},{"code":"53625.0","system":"med"},{"code":"53985.0","system":"med"},{"code":"54387.0","system":"med"},{"code":"55221.0","system":"med"},{"code":"55236.0","system":"med"},{"code":"57666.0","system":"med"},{"code":"58532.0","system":"med"},{"code":"58716.0","system":"med"},{"code":"58862.0","system":"med"},{"code":"58866.0","system":"med"},{"code":"60013.0","system":"med"},{"code":"61098.0","system":"med"},{"code":"61501.0","system":"med"},{"code":"62405.0","system":"med"},{"code":"62449.0","system":"med"},{"code":"63478.0","system":"med"},{"code":"63867.0","system":"med"},{"code":"64264.0","system":"med"},{"code":"64533.0","system":"med"},{"code":"64993.0","system":"med"},{"code":"65127.0","system":"med"},{"code":"66077.0","system":"med"},{"code":"66410.0","system":"med"},{"code":"66506.0","system":"med"},{"code":"66766.0","system":"med"},{"code":"694.0","system":"med"},{"code":"71250.0","system":"med"},{"code":"73295.0","system":"med"},{"code":"8407.0","system":"med"},{"code":"854.0","system":"med"},{"code":"91511.0","system":"med"},{"code":"91547.0","system":"med"},{"code":"9281.0","system":"med"},{"code":"92994.0","system":"med"},{"code":"94001.0","system":"med"},{"code":"9422.0","system":"med"},{"code":"94299.0","system":"med"},{"code":"97919.0","system":"med"},{"code":"98821.0","system":"med"},{"code":"99000.0","system":"med"},{"code":"99070.0","system":"med"},{"code":"99199.0","system":"med"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('schizophrenia-schizotypal-and-delusional-disorders-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["schizophrenia---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["schizophrenia---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["schizophrenia---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
